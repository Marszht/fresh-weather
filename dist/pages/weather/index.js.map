{"version":3,"sources":["pages/weather/index.js"],"names":["app","getApp","Page","data","statusBarHeight","backgroundImage","backgroundColor","current","temp","weather","humidity","icon","today","tomorrow","city","width","scale","address","lat","lon","onLoad","wx","getSystemInfo","success","res","windowWidth","setData","paddingTop","pages","getCurrentPages","currentPage","length","query","options","province","county","getWeatherData","goDiary","url","navigateTo","e","console","log","cb","fail","hideLoading","showToast","title","duration","then","result","catch","air","onshareAppMessage","isUpdata","path"],"mappings":"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","file":"index.js","sourcesContent":["/*<remove trigger=\"prod\">*/\nimport {getWeather, getAir} from '../../lib/api-mock'\n/*</remove>*/\n/*<jdists trigger=\"prod\">\nimport {getEmotionByOpenidAndDate, getMood, geocoder, getWeather, getAir} from '../../lib/api'\n</jdists>*/\nconst app = getApp()\nPage({\n  data: {\n    statusBarHeight: 32,\n    backgroundImage: \"../../images/cloud.jpg\",\n    backgroundColor: '#62aadc',\n    current: {\n      temp: '0',\n      weather: '数据获取中',\n      humidity: '1',\n      icon: 'xiaolian'\n    },\n    today: {\n      temp: 'N/A',\n      weather: '暂无'\n    },\n    tomorrow: {\n      temp: 'N/A',\n      weather: '暂无'\n    },\n    city: '海口',\n    width: 375,\n    scale: 1,\n    address: '定位中',\n    lat: 40.056974,\n    lon: 116.307689\n  },\n  onLoad() {\n    // 获取系统信息\n    // 用于系统适配\n    wx.getSystemInfo({\n      success: (res) => {\n        let width = res.windowWidth\n        // 适配\n        let scale = width / 375\n        this.setData({\n          width,\n          scale,\n          paddingTop: res.statusBarHeight + 12\n        })\n      }\n    })\n    const pages = getCurrentPages()  // 获取当前加载页面\n    const currentPage = pages[pages.length-1] // 获取当前页面对象\n    //  获取分享过来的地址\n    const query = currentPage.options\n    if (query && query.address && query.lat && query.lon) {\n      // setData 是异步的所以需要先获取数据在获取天气数据\n      this.setData({\n        city,\n        province,\n        county,\n        address,\n        lat,\n        lon\n      },\n    () => {\n      this.getWeatherData()\n    })\n    } else {\n      // this.setDataFormCash()\n      // this.getLoacation()\n    }\n    this.getWeatherData()\n  },\n  // 跳转到签到页面\n  goDiary() {\n    try {\n      let url = `/pages/diary/index`\n      wx.navigateTo({\n        url\n      })\n    } catch (e) {\n      console.log(e)\n    }\n  },\n  // 获取页面数据 天气数据\n  getWeatherData(cb) {\n    // wx.showLoading({\n    //   title: '获取数据中',\n    //   mask: true\n    // })\n    // 失败的回调\n    const fail = (e) => {\n      wx.hideLoading()\n      if (typeof cb === 'function') {\n        cb()\n      }\n      wx.showToast({\n        title: '加载失败， 请稍后重试',\n        icon: 'none',\n        duration: 3000\n      })\n    }\n    const {lat, lon, province, city, county} = this.data\n    // 先传默认的经纬度\n    console.log('lat, lon',lat, lon)\n    getWeather(lat, lon)\n      .then((res) => {\n        wx.hideLoading()\n        if (typeof cb === 'function') {\n          cb()\n        }\n        if (res.result) {\n          console.log('res.result:', res.result)\n        }\n      }) .catch(fail)\n      // 获取空气质量\n      getAir(city)\n        .then((res) => {\n          // 严谨一点\n          if (res && res.result) {\n            console.log('air', res.result)\n            this.setData({\n              air: res.result\n            })\n          }\n        }) \n        .catch((e) => {})\n  },\n  // 一个分享, 分享你当前地址的天气状况\n  onshareAppMessage() {\n    if (!isUpdata) {\n      return {\n        title: '我发现了一个好玩的天气小程序，分享给你看看！',\n        path: 'pages/weather/index'\n      }\n    } else {\n      const {lat, lon, address, province, city, county} = this.data\n      let url = `/pages/weather/index?lat=${lat}&lon=${lon}&address=${address}&province=${province}&city=${city}&county=${county}`\n      return {\n        title: `「${address}」现在天气情况，快打开看看吧！`,\n        path: url\n      }\n    }\n  }\n})"]}