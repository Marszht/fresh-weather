{"version":3,"sources":["lib/chartjs/core/core.animation.js"],"names":["module","exports","Chart","helpers","defaults","global","animation","duration","easing","onProgress","noop","onComplete","Animation","Element","extend","currentStep","numSteps","render","onAnimationProgress","onAnimationComplete","animationService","frameDuration","animations","dropFrames","request","addAnimation","chartInstance","animationObject","lazy","me","animating","index","length","push","requestAnimationFrame","cancelAnimation","findIndex","animationWrapper","splice","requestAnimFrame","call","window","startDigest","startTime","Date","now","framesToDrop","Math","floor","i","endTime"],"mappings":"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","file":"core.animation.js","sourcesContent":["/* global window: false */\n'use strict';\nmodule.exports = function(Chart) {\n\tvar helpers = Chart.helpers;\n\tChart.defaults.global.animation = {\n\t\tduration: 1000,\n\t\teasing: 'easeOutQuart',\n\t\tonProgress: helpers.noop,\n\t\tonComplete: helpers.noop\n\t};\n\tChart.Animation = Chart.Element.extend({\n\t\tcurrentStep: null, // the current animation step\n\t\tnumSteps: 60, // default number of steps\n\t\teasing: '', // the easing to use for this animation\n\t\trender: null, // render function used by the animation service\n\t\tonAnimationProgress: null, // user specified callback to fire on each step of the animation\n\t\tonAnimationComplete: null // user specified callback to fire when the animation finishes\n\t});\n\tChart.animationService = {\n\t\tframeDuration: 17,\n\t\tanimations: [],\n\t\tdropFrames: 0,\n\t\trequest: null,\n\t\t/**\n\t\t * @function Chart.animationService.addAnimation\n\t\t * @param chartInstance {ChartController} the chart to animate\n\t\t * @param animationObject {IAnimation} the animation that we will animate\n\t\t * @param duration {Number} length of animation in ms\n\t\t * @param lazy {Boolean} if true, the chart is not marked as animating to enable more responsive interactions\n\t\t */\n\t\taddAnimation: function(chartInstance, animationObject, duration, lazy) {\n\t\t\tvar me = this;\n\t\t\tif (!lazy) {\n\t\t\t\tchartInstance.animating = true;\n\t\t\t}\n\t\t\tfor (var index = 0; index < me.animations.length; ++index) {\n\t\t\t\tif (me.animations[index].chartInstance === chartInstance) {\n\t\t\t\t\t// replacing an in progress animation\n\t\t\t\t\tme.animations[index].animationObject = animationObject;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tme.animations.push({\n\t\t\t\tchartInstance: chartInstance,\n\t\t\t\tanimationObject: animationObject\n\t\t\t});\n\t\t\t// If there are no animations queued, manually kickstart a digest, for lack of a better word\n\t\t\tif (me.animations.length === 1) {\n\t\t\t\tme.requestAnimationFrame();\n\t\t\t}\n\t\t},\n\t\t// Cancel the animation for a given chart instance\n\t\tcancelAnimation: function(chartInstance) {\n\t\t\tvar index = helpers.findIndex(this.animations, function(animationWrapper) {\n\t\t\t\treturn animationWrapper.chartInstance === chartInstance;\n\t\t\t});\n\t\t\tif (index !== -1) {\n\t\t\t\tthis.animations.splice(index, 1);\n\t\t\t\tchartInstance.animating = false;\n\t\t\t}\n\t\t},\n\t\trequestAnimationFrame: function() {\n\t\t\tvar me = this;\n\t\t\tif (me.request === null) {\n\t\t\t\t// Skip animation frame requests until the active one is executed.\n\t\t\t\t// This can happen when processing mouse events, e.g. 'mousemove'\n\t\t\t\t// and 'mouseout' events will trigger multiple renders.\n\t\t\t\tme.request = helpers.requestAnimFrame.call(window, function() {\n\t\t\t\t\tme.request = null;\n\t\t\t\t\tme.startDigest();\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tstartDigest: function() {\n\t\t\tvar me = this;\n\t\t\tvar startTime = Date.now();\n\t\t\tvar framesToDrop = 0;\n\t\t\tif (me.dropFrames > 1) {\n\t\t\t\tframesToDrop = Math.floor(me.dropFrames);\n\t\t\t\tme.dropFrames = me.dropFrames % 1;\n\t\t\t}\n\t\t\tvar i = 0;\n\t\t\twhile (i < me.animations.length) {\n\t\t\t\tif (me.animations[i].animationObject.currentStep === null) {\n\t\t\t\t\tme.animations[i].animationObject.currentStep = 0;\n\t\t\t\t}\n\t\t\t\tme.animations[i].animationObject.currentStep += 1 + framesToDrop;\n\t\t\t\tif (me.animations[i].animationObject.currentStep > me.animations[i].animationObject.numSteps) {\n\t\t\t\t\tme.animations[i].animationObject.currentStep = me.animations[i].animationObject.numSteps;\n\t\t\t\t}\n\t\t\t\tme.animations[i].animationObject.render(me.animations[i].chartInstance, me.animations[i].animationObject);\n\t\t\t\tif (me.animations[i].animationObject.onAnimationProgress && me.animations[i].animationObject.onAnimationProgress.call) {\n\t\t\t\t\tme.animations[i].animationObject.onAnimationProgress.call(me.animations[i].chartInstance, me.animations[i]);\n\t\t\t\t}\n\t\t\t\tif (me.animations[i].animationObject.currentStep === me.animations[i].animationObject.numSteps) {\n\t\t\t\t\tif (me.animations[i].animationObject.onAnimationComplete && me.animations[i].animationObject.onAnimationComplete.call) {\n\t\t\t\t\t\tme.animations[i].animationObject.onAnimationComplete.call(me.animations[i].chartInstance, me.animations[i]);\n\t\t\t\t\t}\n\t\t\t\t\t// executed the last frame. Remove the animation.\n\t\t\t\t\tme.animations[i].chartInstance.animating = false;\n\t\t\t\t\tme.animations.splice(i, 1);\n\t\t\t\t} else {\n\t\t\t\t\t++i;\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar endTime = Date.now();\n\t\t\tvar dropFrames = (endTime - startTime) / me.frameDuration;\n\t\t\tme.dropFrames += dropFrames;\n\t\t\t// Do we have more stuff to animate?\n\t\t\tif (me.animations.length > 0) {\n\t\t\t\tme.requestAnimationFrame();\n\t\t\t}\n\t\t}\n\t};\n};\n"]}