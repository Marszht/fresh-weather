{"version":3,"sources":["lib/effect.js"],"names":["STATUS_STOP","STATUS_RUNNING","Particle","ctx","width","height","opts","_timer","_options","status","w","h","_init","setInterval","_draw","console","log","clearInterval","stop","clearRect","draw","Rain","setLineWidth","setLineCap","i","amount","speedFactor","speed","ps","particles","p","x","Math","random","y","l","xs","ys","color","push","length","s","beginPath","moveTo","lineTo","setStrokeStyle","stroke","_update","Star","_getStarOptions","r","blur","opacity","arc","PI","setFillStyle","shadowColor","shadowBlur","fill","closePath","radius","MAX_BLUR","MIN_BLUR","RGB_PROB","RGB_COLR","MAX_COLR","MIN_COLR","floor","round","join","INN_FADE","OUT_FADE","innPrc","outPrc","select","splice","Snow","colors","_colors","ox","rs","v","cos","ParticleName","id","toLowerCase"],"mappings":"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","file":"effect.js","sourcesContent":["//  雨雪效果的实现\nconst STATUS_STOP = 'stop';\nconst STATUS_RUNNING = 'running';\nclass Particle {\n  constructor(ctx, width, height, opts) {\n    // 定时器\n    this._timer = null;\n    this._options = opts || {};\n    this.ctx = ctx;\n    this.status = STATUS_STOP;\n    this.w = width;\n    this.h = height;\n    // 初始化\n    this._init();\n  }\n  // 实例化时第一执行的方法；空，由子类具体实现\n  _init() {}\n  // 每个动效周期内画图用的方法；空，由子类具体实现\n  _draw() {}\n  run() {\n    if (this.status !== STATUS_RUNNING) {\n      // console.log('run')\n      this.status = STATUS_RUNNING;\n      this._timer = setInterval(() => {\n        this._draw()\n      }, 30)\n    }\n    return this;\n  }\n  stop() {\n    console.log('stop')\n    this.status = STATUS_STOP;\n    clearInterval(this._timer);\n    return this;\n  }\n  clear() {\n    console.log('clear')\n    this.stop();\n    this.ctx.clearRect(0, 0, this.w, this.h);\n    this.ctx.draw();\n    return this;\n  }\n}\n/**\n *  xs、ys 分别代表 x、y 方向上的加速度 \n * params x、y 代表单个粒子的位置，\n * 即雨滴开始绘图的位置  即雨滴的下落速度和角度  \n *  l 代表雨滴的长度\n */\nclass Rain extends Particle {\n  // 继承\n  _init() {\n    let ctx = this.ctx;\n    ctx.setLineWidth(2);\n    ctx.setLineCap('round');\n    let h = this.h;\n    let w = this.w;\n    let i;\n    let amount = this._options.amount || 100;\n    let speedFactor = this._options.speedFactor || 0.03;\n    let speed = speedFactor * h;\n    let ps = (this.particles = []);\n    for (i = 0; i< amount; i++) {\n      let p = {\n        x: Math.random() * w,\n        y: Math.random() * h,\n        l: 2 * Math.random(),\n        xs: -1,\n        ys: 10 * Math.random() + speed,\n        color: 'rgba(255, 255, 255, 0.1)'\n      }\n      ps.push(p)\n    }\n  }\n  _update() {\n    let {w, h} = this;\n    for (let ps = this.particles, i = 0; i<ps.length; i++) {\n      let s = ps[i];\n      s.x += s.xs;\n      s.y += s.ys\n      // 重复利用\n      // 也就是当雨滴落出区域后\n      if (s.x > w || s.y > h) {\n        s.x = Math.random() * w;\n        s.y = -10\n      }\n    }\n    console.log('this', this)\n    return this;\n  }\n  _draw() {\n    let ps = this.particles;\n    let ctx = this.ctx;\n    ctx.clearRect(0, 0, this.w, this.h);\n    for (let i =0; i< ps.length; i++) {\n      let s = ps[i];\n      ctx.beginPath();\n      ctx.moveTo(s.x, s.y);\n      ctx.lineTo(s.x + s.l * s.xs, s.y + s.l * s.ys);\n      ctx.setStrokeStyle(s.color);\n      ctx.stroke()\n    }\n    //把雨滴排序后再画图\n    ctx.draw()\n    // 更新， 就是让雨滴动起来\n    return this._update()\n  }\n}\nclass Star extends Particle {\n  _init() {\n    let amount = this._options.amount || 100;\n    let ps = (this.particles = []);\n    for (let i = 0; i < amount; i++) {\n      ps.push(this._getStarOptions())\n    }\n  }\n  _draw() {\n    let ps = this.particles\n    let ctx = this.ctx\n    ctx.clearRect(0, 0, this.w, this.h)\n    for (let i = 0; i < ps.length; i++) {\n      let { x, y, r, blur, opacity, color} = ps[i]\n      ctx.beginPath()\n      ctx.arc(x, y, r, 0, 2 * Math.PI)\n      ctx.setFillStyle(`rgba(${color},${opacity})`)\n      ctx.shadowColor = `rgba(${color},${opacity})`\n      ctx.shadowBlur = blur\n      ctx.fill()\n      ctx.closePath()\n      ps[i].opacity = 1\n    }\n    ctx.draw()\n    this._update()\n  }\n  //  星星参数\n  _getStarOptions() {\n    let {w, h} = this\n    let radius = this._options.radius || 2\n    const MAX_BLUR = radius * 10\n    const MIN_BLUR = 0.1\n    const RGB_PROB = 5\n    const RGB_COLR = [255, 255, 255] //default color\n    const MAX_COLR = [255, 255, 0] //color max\n    const MIN_COLR = [255, 0, 0]\n    let x = Math.random() * w\n    let y = Math.random() * h / 5\n    return {\n      x,\n      y,\n      opacity: 1,\n      blur: Math.random() * (MAX_BLUR - MIN_BLUR) + MIN_BLUR,\n      r: Math.floor(Math.random() * (radius + 0.5) + 0.5),\n      color: (Math.random() <= RGB_PROB / 100\n        ? [\n            Math.round(Math.random() * (MAX_COLR[0] - MIN_COLR[0]) + MIN_COLR[0]),\n            Math.round(Math.random() * (MAX_COLR[1] - MIN_COLR[1]) + MIN_COLR[1]),\n            Math.round(Math.random() * (MAX_COLR[2] - MIN_COLR[2]) + MIN_COLR[2])\n          ]\n        : RGB_COLR).join(',')\n    }\n  }\n  _update() {\n    const INN_FADE = 30 //fade in %\n    const OUT_FADE = 50\n    let amount = this._options.amount\n    let innPrc, outPrc\n    let ps = this.particles\n    // 取出重新插入队尾\n    let select = ps.splice(0, Math.floor(ps.length / 50))\n    for (let i = 0; i < select.length; i++) {\n      ps.push(this._getStarOptions())\n    }\n    for (let i = 0; i < ps.length; i++) {\n      let p = ps[i]\n      innPrc = INN_FADE * amount / 100\n      outPrc = OUT_FADE * amount / 100\n      if (i < outPrc) {\n        p.opacity = i / outPrc\n      } else if (i > amount - innPrc) {\n        p.opacity -= (i - (amount - innPrc)) / innPrc\n      }\n    }\n  }\n} \nclass Snow extends Particle {\n  _init() {\n    let {w, h} = this\n    let colors = this._options._colors || ['#ccc', '#eee', '#fff', '#ddd']\n    let amount = this._options.amount || 100\n    let speedFactor = this._options.speedFactor || 0.03\n    let speed = speedFactor * h * 0.15\n    let radius = this._options.radius || 2\n    let ps = (this.particles = [])\n    for (let i = 0; i < amount; i++) {\n      let x = Math.random() * w\n      let y = Math.random() * h\n      // console.log(x, y)\n      ps.push({\n        x,\n        y,\n        ox: x,\n        ys: Math.random() + speed,\n        r: Math.floor(Math.random() * (radius + 0.5) + 0.5),\n        color: colors[Math.floor(Math.random() * colors.length)],\n        rs: Math.random() * 80\n      })\n    }\n  }\n  _draw() {\n    let ps = this.particles\n    let ctx = this.ctx\n    ctx.clearRect(0, 0, this.w, this.h)\n    for (let i = 0; i < ps.length; i++) {\n      let {x, y, r, color} = ps[i]\n      ctx.beginPath()\n      // console.log(x,y)\n      ctx.arc(x, y, r, 0, Math.PI * 2, false)\n      ctx.setFillStyle(color)\n      ctx.fill()\n      ctx.closePath()\n    }\n    ctx.draw()\n    this._update()\n  }\n  _update() {\n    let {w, h} = this\n    let v = this._options.speedFactor / 10\n    for (let ps = this.particles, i = 0; i < ps.length; i++) {\n      let p = ps[i]\n      let {ox, ys} = p\n      p.rs += v\n      p.x = ox + Math.cos(p.rs) * w / 2\n      p.y += ys\n      // console.log(ys)\n      // 重复利用\n      if (p.x > w || p.y > h) {\n        p.x = Math.random() * w\n        p.y = -10\n      }\n    }\n  }\n}\nexport default (ParticleName, id, width, height, opts) => {\n  switch (ParticleName.toLowerCase()) {\n    case 'rain':\n      return new Rain(id, width, height, opts);\n    case 'snow':\n      return new Snow(id, width, height, opts);\n    case 'star':\n      return new Star(id, width, height, opts)\n  }\n}\n"]}